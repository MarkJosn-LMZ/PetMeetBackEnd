# 虚拟用户帖文管理功能

## 功能概述

PetMeet帖文管理系统现已支持虚拟用户帖文的完整CRUD管理功能，包括：

- 📄 查看用户帖文列表
- 👁️ 查看帖文详情
- ✏️ 编辑帖文内容（开发中）
- 🗑️ 删除用户帖文

## 使用方法

### 1. 启动服务

```bash
# 启动主后端服务器（端口3000）
npm start

# 启动管理系统代理服务器（端口3001）
node start-petmeet-manager.js
```

### 2. 访问管理界面

打开浏览器访问：`http://localhost:3001`

### 3. 管理用户帖文

1. **选择用户**：在左侧用户列表中点击任意虚拟用户
2. **查看帖文**：选择用户后，右侧会自动显示"用户帖文管理"区域
3. **帖文操作**：
   - 点击"👁️ 查看"按钮在新窗口中查看帖文详情
   - 点击"✏️ 编辑"按钮编辑帖文（功能开发中）
   - 点击"🗑️ 删除"按钮删除帖文（需确认）

## 技术实现

### 后端API接口

#### 获取用户帖文列表
```
GET /api/users/:userId/posts?page=1&pageSize=10
```

#### 获取帖文详情
```
GET /api/posts/detail/:postId?adultMode=false
```

#### 删除用户帖文
```
DELETE /api/users/:userId/posts/:postId
```

#### 更新用户帖文
```
PUT /api/users/:userId/posts/:postId
```

### 权限控制

- 管理系统使用特殊的JWT token进行认证
- Token包含真实用户信息（userId, nickName, PetMeetID）
- 管理系统用户拥有删除任何帖文的权限
- 支持虚拟用户和真实用户的帖文管理

### 数据流程

1. **用户选择**：前端选择用户后，提取用户的openid
2. **帖文查询**：调用主后端的帖文流接口，过滤特定用户的帖文
3. **权限验证**：删除/编辑操作前验证帖文所有权
4. **操作执行**：通过代理服务器转发请求到主后端

## 界面特性

### 用户帖文列表
- 显示帖文标题、内容预览、发布时间
- 显示点赞数、评论数、权限设置
- 支持图片缩略图显示
- 支持话题标签显示

### 帖文详情查看
- 在新窗口中打开完整的帖文详情
- 包含所有帖文信息：标题、内容、图片、话题、地点等
- 美观的排版和样式

### 操作反馈
- 成功/失败操作都有明确的提示信息
- 删除操作需要用户确认
- 操作完成后自动刷新列表

## 安全特性

- JWT token认证确保操作安全性
- 管理系统token包含真实用户信息
- 删除操作需要权限验证
- 只能操作虚拟用户的帖文（安全限制）

## 故障排除

### 常见问题

1. **帖文列表为空**
   - 检查用户是否有发布的帖文
   - 确认主后端服务器正常运行

2. **删除失败**
   - 检查用户权限设置
   - 确认帖文确实属于该用户

3. **详情查看失败**
   - 检查帖文ID是否有效
   - 确认代理服务器正常运行

### 日志调试

管理系统提供详细的控制台日志，包括：
- 用户选择操作
- API请求和响应
- 权限验证结果
- 错误信息详情

## 开发计划

- [ ] 帖文编辑功能
- [ ] 批量操作功能
- [ ] 帖文搜索和过滤
- [ ] 帖文统计信息
- [ ] 导出功能

## 更新日志

### v1.0.0 (2025-01-28)
- ✅ 实现用户帖文列表查看
- ✅ 实现帖文详情查看
- ✅ 实现帖文删除功能
- ✅ 修复用户信息显示问题
- ✅ 完善权限控制机制
- ✅ 优化界面交互体验 